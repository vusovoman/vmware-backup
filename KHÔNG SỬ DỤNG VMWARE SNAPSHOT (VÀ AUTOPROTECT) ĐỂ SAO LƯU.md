VMware và tất cả các nền tảng ảo khác không khuyên bạn nên sử dụng các tính năng VMware Snapshot hoặc AutoProtect Snapshot để hoạt động như sao lưu VMware cho các máy ảo. Lý luận và lựa chọn thay thế được nêu dưới đây. Trước hết, bạn cần nhận thức được những gì ảnh chụp nhanh và các tính năng AutoProtect làm và không làm, để đưa ra quyết định sáng suốt.

VMWARE SNAPSHOT LÀ GÌ?
Ảnh chụp nhanh trong VMware là một cơ chế cho phép người dùng máy ảo 'đóng băng' máy và quay trở lại trạng thái đóng băng đó vào một thời điểm sau đó. Đương nhiên, tính năng này rất phổ biến với các nhà phát triển phần mềm và người kiểm tra phần mềm vì nó cho phép họ lặp lại các bài kiểm tra với tất cả các bài kiểm tra có cùng điểm bắt đầu và điều kiện hệ thống được xác định chính xác. Nhưng làm thế nào điều này được thực hiện trong nội bộ? Trong đó có câu trả lời là tại sao bạn không nên coi ảnh chụp nhanh là một cơ chế sao lưu.

VMware thực hiện ảnh chụp nhanh bằng cách lưu đĩa ảo và trạng thái bộ nhớ trong của máy ảo, trong số những thứ khác, thành các tệp riêng biệt, được gọi là tệp ảnh chụp nhanh. Ví dụ: đối với mỗi VMDK (tệp đĩa cứng của máy ảo) và mỗi ảnh chụp nhanh bạn chụp cho VM, sẽ có một VMDK mới. Khi bạn 'đóng băng' một máy ảo bằng cách chụp nhanh nó, VMware sẽ ngừng ghi các thay đổi đĩa vào đĩa ảo ban đầu và thay vào đó bắt đầu một tệp đĩa ảo mới. Sau khi ảnh chụp nhanh được tạo, VMDK ban đầu vẫn không bị ảnh hưởng.

Thật không may, VMware sử dụng một cài đặt mặc định thực sự ngu ngốc mà hầu hết người dùng bỏ qua. Nó dẫn đến việc chia nhỏ các tệp VMDK thành các tệp 2GB. Do đó, một đĩa ảo 2 TB được chia thành 1,024 tệp có kích thước 2GB. Nếu bây giờ bạn nghĩ rằng điều đó thực sự ngu ngốc, hãy xem xét điều này: Nếu bây giờ bạn tiếp tục và chụp hai, ba ảnh chụp nhanh, thư mục VM của bạn sẽ có hơn 3,000 tệp! Và đột nhiên, máy ảo của bạn bắt đầu trở nên thực sự chậm chạp và bạn tự hỏi tại sao.

ĐIỀU GÌ XẢY RA KHI BẠN KHÔI PHỤC ẢNH CHỤP NHANH VMWARE?
Bằng cách khôi phục ảnh chụp nhanh VMware, VMware loại bỏ VMDK thứ cấp nơi các thay đổi được lưu trữ và tải bộ nhớ trong và các cấu trúc khác khỏi điều kiện máy ảo trước đó. Tất cả thông tin này được chứa trong một số tệp liên quan đến ảnh chụp nhanh. Khi máy ảo hoạt động trở lại, các tệp ảnh chụp nhanh sẽ bị xóa.

ĐIỀU GÌ XẢY RA KHI BẠN XÓA ẢNH CHỤP NHANH VMWARE?
Xóa ảnh chụp nhanh còn nhiều việc hơn vì bây giờ bạn đang nói với VMware rằng bạn muốn giữ các thay đổi, điều mà nó 'nghĩ' là không thể; do đó, VMware cần hợp nhất đĩa ảo gốc với những thay đổi đã xảy ra kể từ đó. Nếu có nhiều thay đổi được thực hiện, việc hợp nhất này có thể mất một lúc. Sau khi hoàn tất, các tệp ảnh chụp nhanh sẽ bị xóa.

Hãy để tôi tiêm vào đây một chút suy nghĩ. Cách VMware và các nền tảng khác đã triển khai ảnh chụp nhanh thực sự là bằng chứng cho thấy chúng không được sử dụng để sao lưu và cũng không phù hợp trên các hệ thống sản xuất. Nếu các kiến trúc sư VMware muốn bạn sử dụng ảnh chụp nhanh làm cơ chế bảo vệ, họ sẽ chọn ghi các thay đổi vào đĩa gốc và ghi các khối ban đầu vào tệp 'giữ nguyên bản gốc'. Do đó, sẽ không có tác động đến hiệu suất cho các lần đọc hoặc ghi tiếp theo và việc xóa ảnh chụp nhanh sẽ rất nhanh chóng và dễ dàng. Nhưng đó không phải là cách họ làm điều đó và họ đã làm không phải vì một lý do chính đáng: lý do đơn giản là ảnh chụp nhanh không có nghĩa là sao lưu.

ẢNH CHỤP NHANH CÓ ĐƯỢC PHÉP TRÊN HỆ THỐNG SẢN XUẤT KHÔNG? KHÔNG.
Nhiều quản trị viên hệ thống CNTT có kinh nghiệm sẽ tức giận nếu bạn tạo ảnh chụp nhanh cho một máy ảo sản xuất vì sự kém hiệu quả và phức tạp trong quản lý được nêu ở trên. Một máy ảo không có ảnh chụp nhanh có thể tồn tại chỉ đơn giản là hai tệp, cấu hình và đĩa ảo VMDK. Một máy ảo có ảnh chụp nhanh có thể dễ dàng bao gồm hàng chục đến hàng trăm tệp. Đương nhiên tất cả những điểm không hiệu quả này cộng lại và làm chậm máy chủ. Chúng làm cho việc quản lý cấu trúc dữ liệu VM trở nên quá phức tạp và dễ bị lỗi. Tốt nhất và hiệu quả nhất là không sử dụng ảnh chụp nhanh VMware trên hệ thống sản xuất vì những lý do này.

TẠI SAO CHÍNH XÁC THÌ VMWARE SNAPSHOT VÀ TÍNH NĂNG AUTOPROTECT KHÔNG ĐƯỢC KHUYẾN NGHỊ LÀM VMWARE BACKUP?
Sao lưu một máy ảo là một quá trình hoàn chỉnh và đáng tin cậy hơn nhiều so với việc chỉ đơn giản là chụp nhanh. Trước hết, ảnh chụp nhanh thay đổi chính máy ảo vì chúng giới thiệu các phụ thuộc mới, trong khi [VMware Backup](http://www.vmwarebackup.ovh/) thì không. Nhiều tệp hơn được tạo khi thêm ảnh chụp nhanh và VMware bắt đầu ghi các thay đổi đĩa cho các tệp khác nhau, v.v. Nếu bất kỳ tệp nào bị hỏng hoặc bị mất, toàn bộ máy ảo sẽ bị hỏng. Ảnh chụp nhanh hầu như luôn được lưu trữ trên cùng một đĩa; do đó, một lỗi đĩa đơn giản cũng sẽ ảnh hưởng đến ảnh chụp nhanh. Tuy nhiên, ngay cả khi chỉ cần một ảnh chụp nhanh bị hỏng và các tệp gốc vẫn ổn, trong cả hai trường hợp, máy ảo đều bị hỏng.

Bản sao lưu VMware sử dụng bộ nhớ riêng biệt, lý tưởng nhất là ở một nơi khác trên một thiết bị khác hoặc trong tài khoản đám mây. Nó bảo vệ khỏi tất cả các loại lỗi: ví dụ như phần cứng, phần mềm, phần mềm độc hại, lỗi hệ điều hành và thiệt hại do tai nạn hoặc thậm chí cố ý gây ra bởi những nhân viên bất mãn. Bằng cách lấy các bản sao đáng tin cậy của tất cả các bit thông tin cần thiết để khôi phục máy ảo, bản sao lưu VMware chứa một bộ đầy đủ mọi thứ cần thiết để xây dựng lại máy ảo trên bất kỳ máy chủ VMware nào, chẳng hạn như cấu hình máy ảo, đĩa ảo và tất cả các ảnh chụp nhanh thuộc về VM.

ƯU ĐIỂM SAO LƯU VMWARE SO VỚI ẢNH CHỤP NHANH
Sao lưu VMware trực tiếp tự động vượt trội về mặt kỹ thuật và đáng tin cậy hơn nhiều so với ảnh chụp nhanh. Các bản sao lưu VMware có thể được thực hiện trong khi VM đang chạy hoặc khi nó bị tắt, một trong hai cách đều hoạt động mà không gặp sự cố. Bạn có thể khôi phục VMware Backups và máy ảo được khôi phục có thể được thiết lập để trở thành bản sao của bản gốc, vì vậy bạn có thể so sánh song song. VMware Backups không ảnh hưởng đến hiệu suất sau khi sao lưu xong, không giống như ảnh chụp nhanh làm chậm mọi truy cập đĩa của VM sau khi chúng được tạo. Một hiệu ứng quan trọng khác của ảnh chụp nhanh là các tệp theo dõi nội bộ VMware được ghi vào đĩa rất thường xuyên để theo dõi ảnh chụp nhanh bitmap và trong trường hợp SSD, điều này có thể dẫn đến hao mòn nhanh hơn và do đó hỏng đĩa.

CHIẾN LƯỢC ĐƯỢC ĐỀ XUẤT LÀ GÌ?
Ảnh chụp nhanh là tuyệt vời cho mục đích dự định của họ: kiểm tra phần mềm và hệ điều hành. Ngoài ra, sử dụng chúng rất có thể không phải là một ý tưởng hay, đặc biệt là trên các hệ thống sản xuất. Các máy ảo sản xuất quan trọng nên được bảo vệ bởi một giải pháp sao lưu VMware tốt để bạn có thể khôi phục máy ảo một cách đáng tin cậy trên bất kỳ máy chủ nào, bất kể điều gì xảy ra, mà không ảnh hưởng đến hiệu suất của máy chủ máy ảo về lâu dài hoặc làm phức tạp việc quản lý của nó. Phần mềm sao lưu VMware giúp giữ cho kho dữ liệu VMware gọn gàng và hiệu quả, và các máy ảo chạy ở hiệu suất cao nhất mà không mất phí. Ảnh chụp nhanh ảnh hưởng tiêu cực đến hiệu suất, làm cho việc quản lý lưu trữ trở nên phức tạp hơn, tăng khả năng lỗi, giảm đáng kể số lượng máy ảo mà máy chủ của bạn có thể phục vụ một cách đáng tin cậy và do đó không được khuyến nghị cho mục đích sao lưu.
